<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Diff Bio</title>
  <meta name="description" content="Robotics, Software, Science Development" />

  <link rel="stylesheet" href="style.css" />
</head>

<body>
  <div class="wrap">
    <header class="masthead">
      <div class="brand">
        <p class="eyebrow">Diff Bio</p>
        <h1>Development Blog</h1>
        <p>Follow along with developmental updates on Robotics, Software, and Science.</p>
      </div>

    </header>

    <div class="content-area">
      <div class="pinned-area">
      <div class="section-head">
        <div>
          <h2>Highlighted Posts</h2>
        </div>
      </div>
      <div class="pinned-grid">
        <article class="post pinned-card" data-post="post-protein-dojo"></article>
        <article class="post pinned-card" data-post="post-speed"></article>
      </div>
    </div>

    <div class="layout">
      <main class="feed" id="feed">
        <article class="post timeline-card" id="post-lab-sim" data-tags="lab-automation" data-date="Jan 15, 2026">
          <div class="timeline-meta">
            <span class="timeline-dot"></span>
            <div class="meta">
              <span class="date">Jan 15, 2026</span>
              <span class="tag">Lab Automation</span>
            </div>
          </div>
          <h3 class="post-title">A Tiny Lab Simulation</h3>

          <p>We built a tiny lab simulation to test workflow ideas before we touch hardware.</p>
          <p>
            It lets us sanity-check station flow, timing, and throughput in minutes.
            The fun part: the same control surface can later drive real hardware, so this isn’t throwaway code.
          </p>

          <figure>
            <img class="media-img" src="content/lab_sim.gif" alt="lab simulation prototype loop" />
          </figure>
        </article>

        <article class="post timeline-card" id="post-protein-dojo" data-tags="robotics" data-date="Jan 15, 2026">
          <div class="timeline-meta">
            <span class="timeline-dot"></span>
            <div class="meta">
              <span class="date">Jan 15, 2026</span>
              <span class="tag">Protein Dojo</span>
            </div>
          </div>
          <h3 class="post-title">Protein Dojo</h3>
          <a class="pill-link" href="https://www.proteindojo.com/" target="_blank" rel="noopener">proteindojo.com</a>

          <p>Protein design is finally something everyone can poke at</p>
          <p>
            We built this as a side project so people can try real protein design problems with modern machine learning tools, without a huge setup.
          </p>

          <figure>
            <img class="media-img" src="content/protein_dojo.png" alt="Protein Dojo screenshot" />
          </figure>
        </article>

        <article class="post timeline-card" id="post-rethinking" data-tags="robotics" data-date="Jan 5, 2026">
          <div class="timeline-meta">
            <span class="timeline-dot"></span>
            <div class="meta">
              <span class="date">Jan 5, 2026</span>
              <span class="tag">Rail Robot - Holiday Hackathon</span>
            </div>
          </div>
          <h3 class="post-title">Turning A Demo Into Something Reliable</h3>

          <p>We’re making the robot safer, more repeatable, and harder to accidentally break.</p>
          <p>
            The next upgrades are boring-in-a-good-way: station identification, lift position feedback, and a proper “stop everything” safety path that doesn’t depend on software behaving.
            We also want better access to the motor driver configuration so tuning doesn’t feel like guesswork.
          </p>
          <p>
            Today the control loop runs on a tiny Linux board because it’s convenient, not because it’s perfect.
            Longer term we’ll likely split “fast motor control” onto a dedicated controller and keep Linux for the user interface and logging.
          </p>

          <figure>
            <img class="media-img" src="content/robot_v1p1_schematic.png" alt="control schematic draft" />
          </figure>
        </article>

        <article class="post timeline-card pinned" id="post-demo-pick" data-tags="robotics" data-date="Jan 3, 2026">
          <div class="timeline-meta">
            <span class="timeline-dot"></span>
            <div class="meta">
              <span class="date">Jan 3, 2026</span>
              <span class="tag">Rail Robot - Holiday Hackathon</span>
            </div>
          </div>
          <h3 class="post-title">A First End To End Demo</h3>
          <p>The cart picks up a plate, rides the rail, and drops it off — end to end.</p>
          <p>
            It’s simple on purpose: two stations, a lift, and one controller loop doing the whole sequence.
            The big win is repeatability: we can now change one thing (mechanism, tuning, software) and immediately see the impact.
          </p>

          <video class="media-video" controls preload="metadata">
            <source src="content/speed_test_place.mp4" type="video/mp4" />
            Sorry, your browser doesn't support embedded videos.
          </video>
        </article>

        <article class="post timeline-card" id="post-station" data-tags="robotics" data-date="Jan 2, 2026">
          <div class="timeline-meta">
            <span class="timeline-dot"></span>
            <div class="meta">
              <span class="date">Jan 2, 2026</span>
              <span class="tag">Rail Robot - Holiday Hackathon</span>
            </div>
          </div>
          <h3 class="post-title">A Simple Station</h3>

          <p>A station is just a small “landing pad” that makes placement predictable.</p>
          <p>
            Ours is a simple printed part with a lip that guides the plate into the same spot every time.
            Later we can add sensing and locking, but this gets us to reliable demos fast.
          </p>

          <figure>
            <img class="media-img" src="content/simple_station.png" alt="simple station design" />
          </figure>
        </article>

        <article class="post timeline-card" id="post-cam-lift" data-tags="robotics" data-date="Jan 1, 2026">
          <div class="timeline-meta">
            <span class="timeline-dot"></span>
            <div class="meta">
              <span class="date">Jan 1, 2026</span>
              <span class="tag">Rail Robot - Holiday Hackathon</span>
            </div>
          </div>
          <h3 class="post-title">A Better Lift Mechanism</h3>

          <p>We replaced a wobbly scissor lift with a compact cam lift.</p>
          <p>The motion is smoother, the parts see less stress, and the plate is less likely to do anything exciting on the way up.</p>

          <figure>
            <img class="media-img" src="content/cam_lift.png" alt="cam lift design" />
            <img class="media-img" src="content/plate_holding.jpg" alt="cam lift design" />
          </figure>
        </article>

        <article class="post timeline-card" id="post-wire-clean" data-tags="robotics" data-date="Dec 27, 2025">
          <div class="timeline-meta">
            <span class="timeline-dot"></span>
            <div class="meta">
              <span class="date">Dec 27, 2025</span>
              <span class="tag">Rail Robot - Holiday Hackathon</span>
            </div>
          </div>
          <h3 class="post-title">Wiring That Survives Real Life</h3>

          <p>We rewired the prototype so it survives tweaks, bumps, and cats.</p>
          <p>
            The breadboard era is over: we moved to a soldered board with clean headers, and routed the moving wires so they can’t snag during motion.
            It’s not glamorous work, but it’s the difference between a demo that works once and a prototype you can iterate on daily.
          </p>

          <figure>
            <img class="media-img" src="content/rewire.jpg" alt="consolidation of electrical design" />
          </figure>

          <p>Everything now breaks out cleanly, which makes debugging (and reconfiguring) way less painful.</p>
          <figure>
            <img class="media-img" src="content/board_front.jpg" alt="consolidation of electrical design" />
          </figure>
          <figure>
            <img class="media-img" src="content/board_back.jpg" alt="consolidation of electrical design" />
          </figure>
        </article>

        <article class="post timeline-card" id="post-speed" data-tags="robotics software" data-date="Dec 26, 2025">
          <div class="timeline-meta">
            <span class="timeline-dot"></span>
            <div class="meta">
              <span class="date">Dec 26, 2025</span>
              <span class="tag">Rail Robot - Holiday Hackathon</span>
            </div>
          </div>
          <h3 class="post-title">Getting The Rail Moving Fast</h3>

          <p>We pushed the rail speed until it started to scare the cat.</p>
          <p>
            The biggest constraint right now is mechanical: if we accelerate too hard, torque can pop the cart off the track.
            That’s a great sign, because it means the next gains are mostly design and packaging, not “rewrite everything.”
          </p>

          <video class="media-video" controls preload="metadata">
            <source src="content/speed_test.mp4" type="video/mp4" />
            Sorry, your browser doesn't support embedded videos.
          </video>
        </article>

        <article class="post timeline-card" id="post-cad" data-tags="robotics" data-date="Dec 21, 2025">
          <div class="timeline-meta">
            <span class="timeline-dot"></span>
            <div class="meta">
              <span class="date">Dec 21, 2025</span>
              <span class="tag">Rail Robot - Holiday Hackathon</span>
            </div>
          </div>
          <h3 class="post-title">Arguing In 3D Before Printing</h3>

          <p>We modeled the whole system in three dimensions so we could find the dumb problems early.</p>
          <p>It saved us from a bunch of “print, assemble, swear, reprint” loops, and made tradeoffs obvious before the first screw went in.</p>

          <figure>
            <img class="media-img" src="content/cad1.png" alt="" />
            <img class="media-img" src="content/cad2.png" alt="" />
            <img class="media-img" src="content/cad3.png" alt="" />
          </figure>
        </article>

        <article class="post timeline-card" id="post-sketches" data-tags="robotics" data-date="Dec 18, 2025">
          <div class="timeline-meta">
            <span class="timeline-dot"></span>
            <div class="meta">
              <span class="date">Dec 18, 2025</span>
              <span class="tag">Rail Robot - Holiday Hackathon</span>
            </div>
          </div>
          <h3 class="post-title">The First Sketches</h3>

          <p>The original idea: move plates like a tiny factory line instead of a fancy robot arm.</p>
          <p>We wanted something cheap, fast to hack on, and good enough to teach us what matters before we overbuild.</p>

          <figure>
            <img class="media-img" src="content/sketch1.png" alt="" />
            <img class="media-img" src="content/sketch2.png" alt="" />
          </figure>
        </article>
      </main>
      <aside class="timeline-rail" id="timeline-rail">
        <div class="rail-line"></div>
      </aside>
    </div>
    </div>
    <footer>
      © <span id="year"></span>
    </footer>
  </div>

  <div class="media-modal" id="media-modal" aria-hidden="true">
    <div class="media-modal__backdrop" data-modal-close></div>
    <div class="media-modal__content" role="dialog" aria-modal="true" aria-label="Image preview">
      <img class="media-modal__img" alt="" />
      <button class="media-modal__close" type="button" data-modal-close>Close</button>
    </div>
  </div>

  <script>
    document.getElementById("year").textContent = new Date().getFullYear();

    const feedPosts = Array.from(document.querySelectorAll(".feed .post"));
    const timelineRail = document.getElementById("timeline-rail");
    const timelineNodes = [];
    let activeGroup = "";

    const monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
    const parseDate = (value) => {
      if (!value) return null;
      const parsed = new Date(value);
      if (Number.isNaN(parsed.getTime())) return null;
      return parsed;
    };
    const getPostDateString = (post) => {
      const attr = post.dataset.date?.trim();
      if (attr) return attr;
      const dateEl = post.querySelector(".date");
      return dateEl?.textContent?.trim() || "";
    };
    const monthKeyFromDate = (value) => {
      const parsed = parseDate(value);
      if (!parsed) return "Unknown";
      return `${parsed.getFullYear()}-${String(parsed.getMonth() + 1).padStart(2, "0")}`;
    };
    const monthLabelFromDate = (value) => {
      const parsed = parseDate(value);
      if (!parsed) return "Unknown";
      return `${monthNames[parsed.getMonth()]} ${parsed.getFullYear()}`;
    };
    const getPostMeta = () =>
      feedPosts.map((post, index) => {
        const dateString = getPostDateString(post);
        const parsed = parseDate(dateString);
        return {
          index,
          post,
          parsed,
          timestamp: parsed ? parsed.getTime() : null,
          groupKey: monthKeyFromDate(dateString),
          groupLabel: monthLabelFromDate(dateString),
        };
      });

    const setActiveTimelineGroup = (groupKey) => {
      activeGroup = groupKey;
      timelineNodes.forEach((node) => {
        node.classList.toggle("active", node.dataset.group === groupKey && !node.hidden);
      });
    };

    const scrollToPostIndex = (index) => {
      const target = feedPosts[index];
      if (!target || target.hidden) return;
      target.scrollIntoView({ behavior: "smooth", block: "start" });
    };

    const createTimeline = () => {
      timelineRail.innerHTML = '<div class="rail-line"></div>';
      const todayButton = document.createElement("button");
      todayButton.type = "button";
      todayButton.className = "timeline-today";
      todayButton.textContent = "Today";
      todayButton.addEventListener("click", () => {
        const meta = getPostMeta()
          .filter((item) => !item.post.hidden)
          .sort((a, b) => (b.timestamp ?? -Infinity) - (a.timestamp ?? -Infinity));
        if (meta.length) scrollToPostIndex(meta[0].index);
      });
      timelineRail.appendChild(todayButton);

      const meta = getPostMeta();
      const groups = Array.from(
        meta
          .filter((item) => item.groupKey !== "Unknown")
          .reduce((acc, item) => {
            if (!acc.has(item.groupKey)) {
              acc.set(item.groupKey, {
                key: item.groupKey,
                label: item.groupLabel,
                timestamp: item.timestamp ?? -Infinity,
              });
            }
            return acc;
          }, new Map())
          .values()
      ).sort((a, b) => b.timestamp - a.timestamp);

      groups.forEach((group) => {
        const node = document.createElement("button");
        node.type = "button";
        node.className = "timeline-node";
        node.dataset.group = group.key;
        node.innerHTML = `
          <span class="timeline-dot"></span>
          <span class="timeline-label">${group.label}</span>
        `;
        node.addEventListener("click", () => {
          const groupPosts = meta.filter((item) => item.groupKey === group.key);
          if (!groupPosts.length) return;
          const target = groupPosts.sort((a, b) => (b.timestamp ?? -Infinity) - (a.timestamp ?? -Infinity))[0];
          scrollToPostIndex(target.index);
        });
        timelineRail.appendChild(node);
        timelineNodes.push(node);
      });
    };

    createTimeline();
    if (feedPosts.length) {
      const meta = getPostMeta().sort((a, b) => (b.timestamp ?? -Infinity) - (a.timestamp ?? -Infinity));
      setActiveTimelineGroup(meta[0]?.groupKey || "");
    }

    const updateActiveOnScroll = () => {
      const threshold = window.scrollY + window.innerHeight / 3;
      let current = activeGroup;
      for (let i = 0; i < feedPosts.length; i += 1) {
        const post = feedPosts[i];
        if (post.hidden) continue;
        if (post.offsetTop >= threshold) {
          current = monthKeyFromDate(getPostDateString(post));
          break;
        }
      }
      if (current) setActiveTimelineGroup(current);
    };

    let scrollScheduled = false;
    window.addEventListener("scroll", () => {
      if (scrollScheduled) return;
      scrollScheduled = true;
      requestAnimationFrame(() => {
        updateActiveOnScroll();
        scrollScheduled = false;
      });
    });

    const SUMMARY_MAX_CHARS = 110;

    const truncateAtWord = (text, maxChars) => {
      const clean = text.trim().replace(/\s+/g, " ");
      if (clean.length <= maxChars) return clean;
      const sliced = clean.slice(0, maxChars + 1);
      const lastSpace = sliced.lastIndexOf(" ");
      const cut = (lastSpace > 40 ? sliced.slice(0, lastSpace) : sliced.slice(0, maxChars)).trim();
      return `${cut}...`;
    };

    const getFirstSentence = (text) => {
      const match = text.match(/[^.!?]+[.!?]+/);
      return match ? match[0].trim() : text.trim();
    };

    const getSummaryText = (text) => truncateAtWord(getFirstSentence(text), SUMMARY_MAX_CHARS);

    const populatePinnedPosts = () => {
      const pinnedCards = Array.from(document.querySelectorAll(".pinned-card[data-post]"));
      pinnedCards.forEach((card) => {
        const targetId = card.dataset.post;
        if (!targetId) return;
        const source = document.getElementById(targetId);
        if (!source) return;

        const meta = source.querySelector(".meta");
        const dateText = source.querySelector(".date")?.textContent?.trim() || "";
        const tagText = meta?.querySelector(".tag")?.textContent?.trim() || "";
        const titleText = source.querySelector(".post-title")?.textContent?.trim() || "";
        const firstParagraph = source.querySelector("p");
        const summaryText = firstParagraph ? getSummaryText(firstParagraph.textContent) : "";
        const media = source.querySelector("img, video");

        card.innerHTML = "";

        const metaWrap = document.createElement("div");
        metaWrap.className = "meta";
        if (dateText) {
          const dateSpan = document.createElement("span");
          dateSpan.textContent = dateText;
          metaWrap.appendChild(dateSpan);
        }
        if (tagText) {
          const tagSpan = document.createElement("span");
          tagSpan.className = "tag";
          tagSpan.textContent = tagText;
          metaWrap.appendChild(tagSpan);
        }
        card.appendChild(metaWrap);

        const title = document.createElement("h3");
        title.className = "post-title";
        title.textContent = titleText;
        card.appendChild(title);

        if (summaryText) {
          const summary = document.createElement("p");
          summary.textContent = summaryText;
          card.appendChild(summary);
        }

        if (media) {
          if (media.tagName.toLowerCase() === "video") {
            const video = document.createElement("video");
            video.className = "media-video pinned-media";
            video.autoplay = true;
            video.muted = true;
            video.loop = true;
            video.playsInline = true;
            const sourceEl = media.querySelector("source");
            if (sourceEl?.getAttribute("src")) {
              const src = sourceEl.getAttribute("src");
              const type = sourceEl.getAttribute("type") || "video/mp4";
              const sourceNode = document.createElement("source");
              sourceNode.setAttribute("src", src);
              sourceNode.setAttribute("type", type);
              video.appendChild(sourceNode);
            }
            card.appendChild(video);
          } else {
            const img = document.createElement("img");
            img.className = "media-img pinned-media";
            img.src = media.getAttribute("src") || "";
            img.alt = media.getAttribute("alt") || "";
            card.appendChild(img);
          }
        }

        const link = document.createElement("a");
        link.className = "subtle-link";
        link.href = `#${targetId}`;
        link.textContent = "Jump to full post";
        card.appendChild(link);
      });
    };

    const buildPostSummaries = () => {
      feedPosts.forEach((post) => {
        const firstParagraph = post.querySelector("p");
        if (!firstParagraph) return;

        const summary = document.createElement("p");
        summary.className = "post-summary";
        summary.textContent = getSummaryText(firstParagraph.textContent);
        post.insertBefore(summary, firstParagraph);

        const mediaSummary = document.createElement("div");
        mediaSummary.className = "post-media-summary";
        const mediaItems = Array.from(post.querySelectorAll("img, video"));
        mediaItems.forEach((item) => {
          if (item.closest(".post-media-summary")) return;
          const clone = item.cloneNode(true);
          clone.classList.add("media-thumb");
          if (clone.tagName.toLowerCase() === "video") {
            clone.removeAttribute("controls");
            clone.muted = true;
            clone.loop = true;
            clone.playsInline = true;
            clone.autoplay = true;
            clone.preload = "metadata";
          }
          mediaSummary.appendChild(clone);
        });
        if (mediaSummary.children.length) {
          post.insertBefore(mediaSummary, firstParagraph);
        }

        const body = document.createElement("div");
        body.className = "post-body";
        post.insertBefore(body, firstParagraph);

        let current = body.nextSibling;
        while (current) {
          const next = current.nextSibling;
          body.appendChild(current);
          current = next;
        }

        const toggle = document.createElement("button");
        toggle.type = "button";
        toggle.className = "post-toggle";
        toggle.textContent = "Read More";
        toggle.setAttribute("aria-expanded", "false");
        toggle.addEventListener("click", () => {
          const expanded = post.classList.toggle("expanded");
          toggle.textContent = expanded ? "Read Less" : "Read More";
          toggle.setAttribute("aria-expanded", expanded ? "true" : "false");
        });
        post.appendChild(toggle);
      });
    };

    const modal = document.getElementById("media-modal");
    const modalImage = modal?.querySelector(".media-modal__img");
    const closeModal = () => {
      if (!modal || !modalImage) return;
      modal.classList.remove("is-open");
      modal.setAttribute("aria-hidden", "true");
      modalImage.src = "";
    };
    const openModal = (src, alt) => {
      if (!modal || !modalImage) return;
      modalImage.src = src;
      modalImage.alt = alt || "";
      modal.classList.add("is-open");
      modal.setAttribute("aria-hidden", "false");
    };

    buildPostSummaries();
    populatePinnedPosts();

    document.addEventListener("click", (event) => {
      const target = event.target;
      if (!(target instanceof HTMLElement)) return;
      if (target.closest("[data-modal-close]")) {
        closeModal();
        return;
      }
      const image = target.closest("img.media-img, img.media-thumb");
      if (image instanceof HTMLImageElement) {
        openModal(image.src, image.alt);
      }
    });

    document.addEventListener("keydown", (event) => {
      if (event.key === "Escape") closeModal();
    });
  </script>
</body>
</html>
